{"version":3,"sources":["components/TopNavBar.js","components/Message.js","components/Image.js","utils/commons.js","utils/api.js","utils/gallery.js","components/ImageGallery.js","components/Home.js","components/App.js","index.js"],"names":["TopNavBar","react_default","a","createElement","Navbar_default","bg","sticky","Brand","className","react_router_dom","to","Collapse","style","justifyContent","Nav_default","Link","href","OverlayTrigger_default","placement","overlay","Tooltip_default","id","index_esm","size","Component","Message","this","props","icon","Spinner_default","animation","info","Image","state","titleWidth","imageWidth","_this$props","index","onClick","photo","margin","e","width","height","src","thumb_src","alt","title","backgroundImage","concat","tiny_src","backgroundSize","getThumbURL","filename","replace","substr","hash","md5","hash1","hash2","fetchDepictions","qid","fetch","then","res","json","images","query","search","map","p","encodeURIComponent","url","caption","totalhits","searchinfo","catch","err","console","log","lightboxTheme","arrow",":hover","opacity","backgroundColor","fill","transition","arrow__direction__left","marginLeft","arrow__direction__right","marginRight","arrow__size__medium","@media (min-width: 768px)","padding","borderRadius","marginTop","container","background","figure","boxShadow","close","footer","color","footerCaption","display","alignItems","footerCount","ImageGallery","label","loadingStatus","currentImage","lightboxIsOpen","fetchImages","_this","_ref","setState","length","handleImagesLoaded","new_images","forEach","img","i","imgElement","document","getElementById","naturalWidth","push","Object","objectSpread","naturalHeight","showQID","openLightbox","event","obj","closeLightbox","gotoPrevious","gotoNext","onClickImage","window","open","lightboxCaption","image","linkString","renderToString","_this2","match","params","toUpperCase","status","entities","labels","en","value","validateQID","prevProps","prevState","_this3","_this$state","Container_default","components_Message","IoIosWarning","dist_index_esm","bounds","onResize","contentRect","_ref2","measureRef","ref","columns","parseInt","Row_default","react_photo_gallery_esm","photos","ImageComponent","Lightbox_default","onClose","onClickPrev","onClickNext","isOpen","theme","spinnerColor","backdropClosesModal","OnImagesLoaded_default","onLoaded","key","Home","target","rel","App","react_router","path","component","exact","WebFont","load","google","families","ReactDOM","render","src_components_App"],"mappings":"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","file":"static/js/main.3f0ffa90.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\nimport Tooltip from 'react-bootstrap/Tooltip'\nimport { GoMarkGithub } from 'react-icons/go'\nimport { Link } from 'react-router-dom'\n\nclass TopNavBar extends Component {\n  render() {\n    return (\n      <Navbar bg=\"light\" sticky=\"top\">\n        <Navbar.Brand>\n          <span className=\"app-name\">\n            <Link to=\"/\">Depicts</Link>\n          </span>\n        </Navbar.Brand>\n        <Navbar.Collapse style={{ justifyContent: 'flex-end' }}>\n          <Nav>\n            <Nav.Link href=\"https://github.com/stevenliuyi/commons-depicts\">\n              <OverlayTrigger\n                placement=\"bottom\"\n                overlay={<Tooltip id=\"source\">source code</Tooltip>}\n              >\n                <GoMarkGithub size={18} />\n              </OverlayTrigger>\n            </Nav.Link>\n          </Nav>\n        </Navbar.Collapse>\n      </Navbar>\n    )\n  }\n}\n\nexport default TopNavBar\n","import React, { Component } from 'react'\nimport Spinner from 'react-bootstrap/Spinner'\n\nclass Message extends Component {\n  render() {\n    return (\n      <div className=\"message\">\n        {this.props.icon === 'spinner' ? (\n          <Spinner animation=\"border\" size=\"md\" className=\"message-icon\" />\n        ) : (\n          <this.props.icon size={36} className=\"message-icon\" />\n        )}\n        <div>{this.props.info}</div>\n      </div>\n    )\n  }\n}\n\nexport default Message\n","import React, { Component } from 'react'\n\nclass Image extends Component {\n  state = {\n    titleWidth: -1,\n    imageWidth: -1\n  }\n\n  render() {\n    const { index, onClick, photo, margin } = this.props\n    return (\n      <div\n        style={{ margin: margin }}\n        onClick={e => onClick(e, { index, photo })}\n      >\n        <img\n          className=\"thumb-image\"\n          width={photo.width}\n          height={photo.height}\n          src={photo.thumb_src}\n          alt={photo.title}\n          style={{\n            backgroundImage: `url(${photo.tiny_src})`,\n            backgroundSize: 'cover'\n          }}\n        />\n      </div>\n    )\n  }\n}\n\nexport default Image\n","import md5 from 'blueimp-md5'\n\nexport const getThumbURL = (title, width) => {\n  const filename = title.replace(/ /g, '_').substr(5)\n  const hash = md5(filename)\n  const hash1 = hash.substr(0, 1)\n  const hash2 = hash.substr(0, 2)\n  const thumb_src = `https://upload.wikimedia.org/wikipedia/commons/thumb/${hash1}/${hash2}/${filename}/${width}-${filename}`\n\n  return thumb_src\n}\n\nexport const getOriginalURL = title =>\n  `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(\n    title.substr(5)\n  )}`\n","import { getThumbURL, getOriginalURL } from './commons'\n\nexport const fetchSPARQLResult = sparql =>\n  fetch(\n    `https://query.wikidata.org/sparql?query=${encodeURIComponent(\n      sparql\n    )}&format=json`\n  )\n    .then(res => {\n      return res.status >= 400 ? null : res.json()\n    })\n    .catch(err => {\n      console.log(err)\n      return null\n    })\n\nexport const validateQID = qid =>\n  fetch(\n    `https://www.wikidata.org/w/api.php?action=wbgetentities&props=labels&ids=${qid}&languages=en&format=json&origin=*`\n  )\n    .then(res => {\n      return res.status >= 400 ? null : res.json()\n    })\n    .then(res =>\n      res.entities == null\n        ? null\n        : res.entities[qid].labels.en\n        ? res.entities[qid].labels.en.value\n        : ''\n    )\n    .catch(err => {\n      console.log(err)\n      return null\n    })\n\nexport const fetchDepictions = qid =>\n  fetch(\n    `https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=haswbstatement:P180=${qid}&srnamespace=6&srlimit=100&format=json&origin=*`\n  )\n    .then(res => res.json())\n    .then(res => ({\n      images: res.query.search.map(p => ({\n        thumb_src: getThumbURL(p.title, '300px'),\n        src: getOriginalURL(p.title),\n        tiny_src: getThumbURL(p.title, '10px'),\n        url: `https://commons.wikimedia.org/wiki/${p.title.replace(/ /g, '_')}`,\n        caption: p.title\n      })),\n      totalhits: res.query.searchinfo.totalhits\n    }))\n    .catch(err => {\n      console.log(err)\n      return null\n    })\n","export const lightboxTheme = {\n  arrow: {\n    ':hover': { opacity: 1 },\n    backgroundColor: 'rgba(255, 255, 255, .8)',\n    fill: '#222',\n    opacity: 0.6,\n    transition: 'opacity .2s'\n  },\n  arrow__direction__left: {\n    marginLeft: 10\n  },\n  arrow__direction__right: {\n    marginRight: 10\n  },\n  arrow__size__medium: {\n    '@media (min-width: 768px)': {\n      height: 70,\n      padding: 15\n    },\n    borderRadius: 40,\n    height: 40,\n    marginTop: -20\n  },\n  container: {\n    background: 'rgba(255, 255, 255, .9)'\n  },\n  figure: {\n    boxShadow: '0px 0px 50px rgba(0, 0, 0, .2)'\n  },\n  close: {\n    ':hover': { opacity: 1 },\n    fill: '#222',\n    opacity: 0.6\n  },\n  footer: {\n    color: '#222',\n    marginLeft: '5px',\n    marginRight: '5px'\n  },\n  footerCaption: {\n    display: 'inline-flex',\n    alignItems: 'center'\n  },\n  footerCount: {\n    color: '#222',\n    display: 'none'\n  }\n}\n","import React, { Component } from 'react'\nimport { renderToString } from 'react-dom/server'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport OnImagesLoaded from 'react-on-images-loaded'\nimport Measure from 'react-measure'\nimport Gallery from 'react-photo-gallery'\nimport { IoIosWarning } from 'react-icons/io'\nimport Lightbox from 'react-images'\nimport Message from './Message'\nimport Image from './Image'\nimport { validateQID, fetchDepictions } from '../utils/api'\nimport { lightboxTheme } from '../utils/gallery'\n\nclass ImageGallery extends Component {\n  state = {\n    qid: null,\n    label: null,\n    images: [],\n    totalhits: 0,\n    width: -1,\n    loadingStatus: null, // loading or loaded\n    currentImage: 0,\n    lightboxIsOpen: false\n  }\n\n  fetchImages = () => {\n    if (this.state.qid == null) return\n    fetchDepictions(this.state.qid).then(({ images, totalhits }) =>\n      this.setState({\n        images,\n        totalhits,\n        loadingStatus: images.length > 0 ? 'loading' : 'loaded'\n      })\n    )\n  }\n\n  handleImagesLoaded = () => {\n    // obtain heights and widths of the images\n    let new_images = []\n    this.state.images.forEach((img, i) => {\n      const imgElement = document.getElementById(`img${i}`)\n      if (imgElement.naturalWidth > 0)\n        new_images.push({\n          ...this.state.images[i],\n          width: imgElement.naturalWidth,\n          height: imgElement.naturalHeight\n        })\n    })\n    this.setState({ images: new_images, loadingStatus: 'loaded' })\n  }\n\n  showQID = () =>\n    this.state.label\n      ? `${this.state.qid} (${this.state.label})`\n      : this.state.qid\n\n  componentDidMount() {\n    const qid = this.props.match.params.qid.toUpperCase()\n    validateQID(qid).then(label => this.setState({ qid, label }))\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.qid !== this.state.qid) this.fetchImages()\n  }\n\n  openLightbox = (event, obj) =>\n    this.setState({ currentImage: obj.index, lightboxIsOpen: true })\n\n  closeLightbox = () =>\n    this.setState({ currentImage: 0, lightboxIsOpen: false })\n\n  gotoPrevious = () =>\n    this.setState({ currentImage: this.state.currentImage - 1 })\n\n  gotoNext = () => this.setState({ currentImage: this.state.currentImage + 1 })\n\n  onClickImage = e => {\n    window.open(this.state.images[this.state.currentImage].url, '_blank')\n  }\n\n  lightboxCaption = image => {\n    const linkString = renderToString(<a href={image.url}>a</a>)\n    return `<span>${image.title}${linkString}</span>`\n  }\n\n  render() {\n    const {\n      qid,\n      label,\n      images,\n      totalhits,\n      width,\n      loadingStatus,\n      currentImage,\n      lightboxIsOpen\n    } = this.state\n    if (qid == null) return <div />\n    return (\n      <Container>\n        {label == null && (\n          <Message\n            icon={IoIosWarning}\n            info={`Wikidata item ${this.showQID()} cannot be found`}\n          />\n        )}\n        {label != null && loadingStatus === 'loading' && (\n          <Message\n            icon=\"spinner\"\n            info={`Loading images depicting Wikidata item ${this.showQID()}`}\n          />\n        )}\n        {label != null && loadingStatus === 'loaded' && images.length > 0 && (\n          <Measure\n            bounds\n            onResize={contentRect =>\n              this.setState({ width: contentRect.bounds.width })\n            }\n          >\n            {({ measureRef }) => {\n              if (width < 1) return <div ref={measureRef} />\n              let columns = 1\n              if (width >= 320) columns = 2\n              if (width >= 750) columns = 3\n              if (width >= 1200) columns = parseInt(width / 300, 10)\n              return (\n                <div ref={measureRef}>\n                  <Row>\n                    <div className=\"depict-title\">\n                      <span>{`Depictions of ${this.showQID()} on Wikimedia Commons`}</span>\n                      <span className=\"depict-hits\">{`${totalhits} images found${\n                        totalhits > 100 ? ', only the first 100 are shown' : ''\n                      }`}</span>\n                    </div>\n                  </Row>\n                  <Gallery\n                    photos={images}\n                    ImageComponent={Image}\n                    columns={columns}\n                    margin={5}\n                    onClick={this.openLightbox}\n                  />\n                  <Lightbox\n                    images={images}\n                    onClose={this.closeLightbox}\n                    onClickPrev={this.gotoPrevious}\n                    onClickNext={this.gotoNext}\n                    onClickImage={this.onClickImage}\n                    currentImage={currentImage}\n                    isOpen={lightboxIsOpen}\n                    theme={lightboxTheme}\n                    spinnerColor={'#aaa'}\n                    backdropClosesModal={true}\n                  />\n                </div>\n              )\n            }}\n          </Measure>\n        )}\n        {label != null && loadingStatus === 'loaded' && images.length === 0 && (\n          <Message\n            icon={IoIosWarning}\n            info={`Cannot find any depictions of ${this.showQID()} on Wikimedia Commons.`}\n          />\n        )}\n        {/* load tiny thumbs to obtain the heights and widths of the images for later display */}\n        {label && loadingStatus === 'loading' && images.length > 0 && (\n          <OnImagesLoaded onLoaded={() => this.handleImagesLoaded()}>\n            {images.map((img, i) => (\n              <img\n                id={`img${i}`}\n                className=\"tiny-images\"\n                key={`img${i}`}\n                src={img.tiny_src}\n                alt=\"\"\n                style={{ display: 'none ' }}\n              />\n            ))}\n          </OnImagesLoaded>\n        )}\n      </Container>\n    )\n  }\n}\n\nexport default ImageGallery\n","import React, { Component } from 'react'\nimport Container from 'react-bootstrap/Container'\nimport { Link } from 'react-router-dom'\n\nclass Home extends Component {\n  render() {\n    return (\n      <Container>\n        <div className=\"info\">\n          <p>\n            This tool is designed for displaying depictions of Wikidata items on\n            Wikimedia Commons. For example, the link{' '}\n            <Link to=\"/Q41994\">/#/Q41994</Link> shows all the images on Commons\n            that depict{' '}\n            <a\n              href=\"https://www.wikidata.org/wiki/Q41994\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              Q41994\n            </a>{' '}\n            (<i>Phoenicopterus</i>, or flamingo).\n          </p>\n          <p>\n            You may also add{' '}\n            <span className=\"source-code\">\n              mw.loader.load(\n              '//www.wikidata.org/w/index.php?title=User:Stevenliuyi/depicts.js&action=raw&ctype=text/javascript'\n              );\n            </span>{' '}\n            to{' '}\n            <a\n              href=\"https://www.wikidata.org/wiki/Special:MyPage/common.js\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              your personal common.js file\n            </a>{' '}\n            on Wikidata, so that you can directly link to this tool from the\n            sidebar on item's page.\n          </p>\n        </div>\n      </Container>\n    )\n  }\n}\n\nexport default Home\n","import React, { Component } from 'react'\nimport './App.css'\nimport 'bootstrap/dist/css/bootstrap.min.css'\nimport { HashRouter as Router, Switch, Route } from 'react-router-dom'\nimport TopNavBar from './TopNavBar'\nimport ImageGallery from './ImageGallery'\nimport Home from './Home'\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"site\">\n        <div className=\"site-content\">\n          <Router>\n            <div>\n              <Route path=\"/\" component={TopNavBar} />\n              <Switch>\n                <Route exact path=\"/:qid([qQ]\\d+)\" component={ImageGallery} />\n                <Route path=\"/\" component={Home} />\n              </Switch>\n            </div>\n          </Router>\n        </div>\n        <footer className=\"footer\">Steven Liu&nbsp;&nbsp;2019</footer>\n      </div>\n    )\n  }\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './components/App'\nimport WebFont from 'webfontloader'\n\nWebFont.load({\n  google: {\n    families: ['Montserrat:700', 'san-serif']\n  }\n})\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}